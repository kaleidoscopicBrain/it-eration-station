<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT-eration Station</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Welcome to IT-eration Station</h1>

        {% if ceo_name == "Player" %}
            <p>Please enter your name:</p>
            <form action="/set_name" method="POST">
                <input type="text" name="player_name" required placeholder="Your Name">
                <button type="submit">Start Game</button>
            </form>
        {% else %}
            <div class="game-info">
                <p>Hello, {{ ceo_name }}!</p>
                <p>Money: ${{ money }}</p>
                <p>Tasks Completed: {{ tasks_completed }}</p>
            </div>

            <div>
                <button id="write_code" class="action-button">Write Code</button>
                <button id="solve_ticket" class="action-button">Solve Ticket</button>
                <a href="{{ url_for('upgrades') }}">
                <button class="action-button">Go to Upgrades</button>
    </a>
            </div>
        {% endif %}
    </div>

    <script>
    // Cooldown time in milliseconds (e.g., 5 seconds)
    var cooldownTime = 5000; // 5 seconds cooldown

    // Function to handle cooldowns and prevent button clicking
    function startCooldown(buttonId, otherButtonId) {
        $(buttonId).prop('disabled', true); // Disable clicked button
        $(otherButtonId).prop('disabled', true); // Disable the other button

        // Add the progress bar
        $(buttonId).append('<div class="cooldown-progress"></div>');

        setTimeout(function() {
            $(buttonId).prop('disabled', false); // Enable clicked button after cooldown
            $(otherButtonId).prop('disabled', false); // Enable the other button
            $(buttonId).find('.cooldown-progress').remove(); // Remove the progress bar
        }, cooldownTime);
    }

    // Send request to write code
    $('#write_code').on('click', function() {
        if (!$(this).prop('disabled')) {
            $.post("/write_code", function(data) {
                if (data.error) {
                    alert("Error: " + data.error);
                } else {
                    // Dynamically update the game info on the page without refreshing
                    $(".game-info").html(`
                        <p>Hello, ${data.ceo_name}!</p>
                        <p>Money: $${data.money}</p>
                        <p>Tasks Completed: ${data.tasks_completed}</p>
                    `);
                    startCooldown("#write_code", "#solve_ticket"); // Apply cooldown to buttons
                }
            }).fail(function(jqXHR, textStatus, errorThrown) {
                console.log("Error:", textStatus, errorThrown);  // Log if AJAX fails
            });
        }
    });

    // Send request to solve ticket
    $('#solve_ticket').on('click', function() {
        if (!$(this).prop('disabled')) {
            $.post("/solve_ticket", function(data) {
                if (data.error) {
                    alert("Error: " + data.error);
                } else {
                    // Dynamically update the game info on the page without refreshing
                    $(".game-info").html(`
                        <p>Hello, ${data.ceo_name}!</p>
                        <p>Money: $${data.money}</p>
                        <p>Tasks Completed: ${data.tasks_completed}</p>
                    `);
                    startCooldown("#solve_ticket", "#write_code"); // Apply cooldown to buttons
                }
            }).fail(function(jqXHR, textStatus, errorThrown) {
                console.log("Error:", textStatus, errorThrown);  // Log if AJAX fails
            });
        }
    });

    // Reset cooldowns when the page loads (making sure both buttons are enabled)
    $(document).ready(function() {
        $(".action-button").prop('disabled', false);  // Ensure both buttons are enabled on page load
    });
</script>


</body>
</html>
